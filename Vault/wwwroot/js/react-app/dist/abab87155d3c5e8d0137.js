(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{37:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),a=n(55),s=n.n(a),i=n(3),c=n.n(i);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=u(this,f(t).call(this,e))).state={started:!1,error:null,finished:!1},n}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r.a.Component),n=t,(o=[{key:"close",value:function(){c.a.close()}},{key:"onClick",value:function(){var e=this;this.setState({started:!0}),fetch("process/deletecomment",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"fileId=".concat(encodeURIComponent(this.props.comment.fileId))+"&commentId=".concat(encodeURIComponent(this.props.comment.id))}).then(function(e){return e.json()}).then(function(t){t.success?(e.props.removeComment&&e.props.removeComment(e.props.comment),c.a.close()):e.setState({finished:!0,error:t.reason})},function(t){e.setState({finished:!0,error:t.message})})}},{key:"render",value:function(){var e=this.state.started&&!this.state.finished?r.a.createElement("center",null,r.a.createElement("div",{className:s.a.loader})):null,t=this.state.started||this.state.finished?null:r.a.createElement("div",null,r.a.createElement("img",{src:"images/comment.svg",style:{height:"86px",opacity:"0.5"}}),r.a.createElement("div",{className:s.a["warning-title"]},"Are you sure?"),r.a.createElement("div",{className:s.a["warning-message"]},r.a.createElement("p",null,"You are about to delete a comment written by ",r.a.createElement("b",null,this.props.comment.author),".")),r.a.createElement("button",{className:s.a.button,onClick:this.onClick.bind(this)},"Delete"),r.a.createElement("button",{className:s.a.button+" "+s.a.inverse,onClick:this.close.bind(this)},"Cancel")),n=this.state.finished&&this.state.error?r.a.createElement("div",null,r.a.createElement("div",{className:s.a["warning-title"]},"Error!"),r.a.createElement("div",{className:s.a["warning-message"]},this.state.error)):null;return r.a.createElement("div",null,e,t,n)}}])&&m(n.prototype,o),a&&m(n,a),t}(),d=n(4);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=n(13).Buffer,C=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=v(this,g(t).call(this,e))).TABLE=[0,8801531,9098509,825846,9692897,1419802,1651692,10452759,10584377,2608578,2839604,11344079,3303384,11807523,12104405,4128302,12930697,4391538,5217156,13227903,5679208,13690003,14450021,5910942,6606768,14844747,15604413,6837830,16197969,7431594,8256604,16494759,840169,9084178,8783076,18463,10434312,1670131,1434117,9678590,11358416,2825259,2590173,10602790,4109873,12122826,11821884,3289031,13213536,5231515,4409965,12912278,5929345,14431610,13675660,5693559,6823513,15618722,14863188,6588335,16513208,8238147,7417269,16212302,1680338,10481449,9664223,1391140,9061683,788936,36926,8838341,12067563,4091408,3340262,11844381,2868234,11372785,10555655,2579964,14478683,5939616,5650518,13661357,5180346,13190977,12967607,4428364,8219746,16457881,16234863,7468436,15633027,6866552,6578062,14816117,1405499,9649856,10463030,1698765,8819930,55329,803287,9047340,11858690,3325945,4072975,12086004,2561507,10574104,11387118,2853909,13647026,5664841,5958079,14460228,4446803,12949160,13176670,5194661,7454091,16249200,16476294,8201341,14834538,6559633,6852199,15647388,3360676,11864927,12161705,4185682,10527045,2551230,2782280,11286707,9619101,1346150,1577872,10379115,73852,8875143,9172337,899466,16124205,7357910,8182816,16421083,6680524,14918455,15678145,6911546,5736468,13747439,14507289,5968354,12873461,4334094,5159928,13170435,4167245,12180150,11879232,3346363,11301036,2767959,2532769,10545498,10360692,1596303,1360505,9604738,913813,9157998,8856728,92259,16439492,8164415,7343561,16138546,6897189,15692510,14936872,6662099,5986813,14488838,13733104,5750795,13156124,5174247,4352529,12855018,2810998,11315341,10498427,2522496,12124823,4148844,3397530,11901793,9135439,862644,110658,8912057,1606574,10407765,9590435,1317464,15706879,6940164,6651890,14889737,8145950,16384229,16161043,7394792,5123014,13133629,12910283,4370992,14535975,5997020,5707818,13718737,2504095,10516836,11329682,2796649,11916158,3383173,4130419,12143240,8893606,129117,876971,9121104,1331783,9576124,10389322,1625009,14908182,6633453,6925851,15721184,7380471,16175372,16402682,8127489,4389423,12891860,13119266,5137369,13704398,5722165,6015427,14517560],n}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,r.a.Component),n=t,(o=[{key:"crc24",value:function(e,t){var n,o,r,a;for(E.isBuffer(e)||(e=E(e)),o=null!==t?~~t:11994318,r=0,a=e.length;r<a;r++)n=e[r],o=16777215&(this.TABLE[255&(o>>16^n)]^o<<8);return o.toString(16).padStart(6,"0")}},{key:"formatDate",value:function(e){var t=new Date,n=new Date(1e3*e),o="".concat(n.getMonth()+1,"/").concat(n.getDate(),"/").concat(n.getFullYear());return n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getFullYear()===t.getFullYear()?o="Today":n.getDate()===t.getDate()-1&&n.getMonth()===t.getMonth()&&n.getFullYear()===t.getFullYear()&&(o="Yesterday"),"".concat(o," at ").concat(n.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}))}},{key:"deleteComment",value:function(){new d.a(r.a.createElement(h,{removeComment:this.props.removeComment,comment:this.props.comment}))}},{key:"render",value:function(){if(!this.props.comment)return null;var e=this.props.comment,t=this.props.local,n={backgroundColor:"#".concat(this.crc24(e.author))};return r.a.createElement("div",{className:s.a["comment-box"]},r.a.createElement("div",{className:s.a["comment-topbar"]},r.a.createElement("div",{className:s.a["comment-avatar"],style:n},e.author[0]),r.a.createElement("div",{className:s.a["comment-author"]},e.author," ",e.isOwner&&r.a.createElement("span",{className:s.a["comment-owner"]},"Author")),r.a.createElement("div",{className:s.a["comment-date"]},this.formatDate(e.created))),r.a.createElement("p",null,e.content,t&&r.a.createElement("a",{onClick:this.deleteComment.bind(this)},"Delete")))}}])&&b(n.prototype,o),a&&b(n,a),t}();function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function k(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=k(this,j(t).call(this,e))).state={isLoading:!1,isCommentsLoading:!0,error:null,response:null,offset:0},n}var n,o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,r.a.Component),n=t,(o=[{key:"componentDidMount",value:function(){this.getComments()}},{key:"postComment",value:function(){var e=this;this.props.id&&(this.isCommentsLoading?this.setState({error:"Please wait while the comments load..."}):(this.setState({isLoading:!0}),fetch(this.props.local?"process/postcomment":"postcomment",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id=".concat(encodeURIComponent(this.props.id))+(this.props.local?"":"&name=".concat(encodeURIComponent(this.name.value)))+"&content=".concat(encodeURIComponent(this.content.value))}).then(function(e){return e.json()}).then(function(t){if(t.success){if(e.state.response)e.state.response.comments.unshift(t.comment),e.state.response.total+=1,e.state.offset=e.state.response.comments.length;else{var n=[];n.push(t.comment),e.state.response={success:!0,comments:n}}e.props.local||(e.name.value=""),e.content.value="",e.setState({isLoading:!1,response:e.state.response,offset:e.state.offset})}else e.setState({isLoading:!1,error:t.reason})},function(t){e.setState({isLoading:!1,error:t.message})})))}},{key:"getComments",value:function(){var e=this;this.props.id&&!this.state.isFinished&&(this.setState({isCommentsLoading:!0}),fetch(this.props.local?"process/comments":"comments",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id=".concat(encodeURIComponent(this.props.id),"&offset=").concat(this.state.offset)}).then(function(e){return e.json()}).then(function(t){if(t.success){var n=null;e.state.response?(n=e.state.response).comments=e.state.response.comments.concat(t.comments):n=t,e.setState({isCommentsLoading:!1,response:n,offset:n.comments.length})}else e.setState({isCommentsLoading:!1,error:t.reason})},function(t){e.setState({isCommentsLoading:!1,error:t.message})}))}},{key:"onClick",value:function(){this.postComment()}},{key:"removeComment",value:function(e){var t=this.state.response.comments.findIndex(function(t){return t.id===e.id});-1!==t&&(this.state.response.comments.splice(t,1),this.state.response.total-=1,this.state.offset=this.state.response.comments.length,this.setState({response:this.state.response,offset:this.state.offset}))}},{key:"render",value:function(){var e=this,t=this.state.error&&r.a.createElement("div",{className:s.a["comment-error"]},this.state.error),n=this.state.response&&this.state.response.comments.map(function(t,n){return r.a.createElement(C,{key:t.id,local:e.props.local,removeComment:e.removeComment.bind(e),comment:t})}),o={display:this.state.isLoading?"none":"block"},a={display:this.state.isLoading?"block":"none"},i={display:this.state.isCommentsLoading?"none":"block"},c={display:this.state.isCommentsLoading?"block":"none"};return r.a.createElement(r.a.Fragment,null,t,r.a.createElement("div",{className:s.a["comment-editor"]},r.a.createElement("div",{className:s.a.loader,style:a}),r.a.createElement("div",{style:o},r.a.createElement("h2",null,"Comments"),!this.props.local&&r.a.createElement("input",{ref:function(t){e.name=t},type:"text",placeholder:"Name"}),r.a.createElement("textarea",{ref:function(t){e.content=t},placeholder:"Write a comment"}),r.a.createElement("br",null),r.a.createElement("button",{className:s.a.button,onClick:this.onClick.bind(this)},"Post"))),r.a.createElement("div",{className:s.a["comment-section"]},r.a.createElement("div",null,n,this.state.response&&this.state.response.comments.length!==this.state.response.total&&r.a.createElement("button",{style:i,className:s.a.button,onClick:this.getComments.bind(this)},"Load more comments...")),r.a.createElement("div",{className:s.a.loader,style:c})))}}])&&O(n.prototype,o),a&&O(n,a),t}();t.default=N}}]);
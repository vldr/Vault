(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{54:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),i=n(3),s=n.n(i),a=n(4),c=n(55),l=n.n(c);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,d(t).apply(this,arguments))}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,r.a.Component),n=t,(o=[{key:"render",value:function(){var e=this,t=this.props.path;return r.a.createElement("div",{className:l.a["folder-path"]},t.map(function(t,n){return r.a.createElement("span",{key:t.id,onClick:e.props.gotoFolder.bind(e,t.id)},t.name," / ")}))}}])&&f(n.prototype,o),i&&f(n,i),t}(),y=n(18),g=n(33);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function w(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=n(36),j=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=w(this,S(t).call(this,e))).state={error:null,finished:!1,response:null,shouldScroll:!1,offset:0},n}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,r.a.Component),n=t,(o=[{key:"componentDidMount",value:function(){var e=this;this.connection=(new O.HubConnectionBuilder).withUrl("notifications").configureLogging(O.LogLevel.Information).build(),this.connection.on("UpdatePathBar",function(){return e.updatePathBar()}),this.connection.on("UpdateListing",function(t){return e.updateListing(t)}),this.connection.on("UpdateFolder",function(t){return e.updateObject(t,"FOLDER")}),this.connection.on("UpdateFile",function(t){return e.updateObject(t,"FILE")}),this.connection.onclose(function(){console.log("Lost connection..."),e.connectToSignalR()}),this.connectToSignalR(),this.requestList(),window.onscroll=function(t){var n=window.innerHeight+window.pageYOffset;e.state.shouldScroll&&n>=.8*document.querySelector("#app").offsetHeight&&e.requestList()}}},{key:"updateObject",value:function(e,t){var n=this.state.response;if(n){var o="FILE"===t?n.files:n.folders,r=o.findIndex(function(t){return t.id===e.id&&t.folder===n.current});-1!==r?(e.folder===n.current?o[r]=e:o.splice(r,1),this.setState({response:n})):e.folder===n.current&&(o.unshift(e),this.setState({response:n})),this.props.updateSearch&&this.props.updateSearch(e,t)}}},{key:"updatePathBar",value:function(){var e=this;fetch("process/getpathbar",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return e.json()}).then(function(t){t.success?(e.state.response.path=t.path,e.setState({response:e.state.response})):new a.a(r.a.createElement("p",null,t.reason))},function(e){new a.a(r.a.createElement("p",null,e.message))})}},{key:"updateListing",value:function(e){this.state.response&&this.state.response.current===e&&this.requestList(!0)}},{key:"connectToSignalR",value:function(){var e=this;this.connection.start().catch(function(t){console.error(t.toString()),setTimeout(e.reconnectToSignalR(),3e3)})}},{key:"requestList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setState({shouldScroll:!1}),t&&(this.state.response=null,this.state.offset=0),fetch("process/list",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"offset=".concat(encodeURIComponent(this.state.offset))}).then(function(e){return e.json()}).then(function(t){if(t.success){var n=e.state.offset+t.files.length;if(e.state.response){var o=t.files.filter(function(t){return!e.state.response.files.some(function(e){return t.id===e.id})});e.state.response.files=e.state.response.files.concat(o)}e.setState({response:e.state.response?e.state.response:t,offset:n,shouldScroll:n!==t.totalFiles}),window.sort=e.state.response.sort,e.state.finished||setTimeout(function(){return e.setState({finished:!0})},300)}else e.setState({response:null,error:t.reason,finished:!0})},function(t){e.setState({finished:!0,error:t.message})})}},{key:"gotoFolder",value:function(e){var t=this;fetch("process/goto",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"folderid=".concat(encodeURIComponent(e))}).then(function(e){return e.json()}).then(function(e){e.success?(t.props.closeSearch&&t.props.closeSearch(),t.setState({response:e,offset:e.files.length,shouldScroll:e.files.length!==e.totalFiles})):t.setState({response:null,error:e.reason,finished:!0})},function(e){t.setState({error:e.message})})}},{key:"openFileLocation",value:function(e){var t=this;new a.a(r.a.createElement("center",null,r.a.createElement("div",{className:"loader"}))),fetch("process/openfilelocation",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"fileid=".concat(encodeURIComponent(e))}).then(function(e){return e.json()}).then(function(e){e.success?(t.props.closeSearch&&t.props.closeSearch(),t.setState({response:e,offset:e.files.length,shouldScroll:e.files.length!==e.totalFiles}),s.a.close()):new a.a(r.a.createElement("p",null,e.reason))},function(e){new a.a(r.a.createElement("p",null,e.message))})}},{key:"render",value:function(){var e=this,t=this.state,n=t.error,o=t.finished,i=t.response,s=r.a.createElement("div",{className:l.a["intro-box"]},r.a.createElement("img",{src:"images/ui/logo.svg"}));if(n)return r.a.createElement("div",{className:l.a.error},r.a.createElement("img",{src:"images/paper.svg"}),r.a.createElement("h2",null,"Something went wrong."),r.a.createElement("p",null,n));if(!o)return r.a.createElement("div",null,s);if(!i.success)return r.a.createElement("p",null,i.reason);if(i.isHome&&0===i.files.length&&0===i.folders.length)return r.a.createElement("center",null,r.a.createElement("img",{className:l.a.wind,src:"images/ui/wind.png"}));var a=i.folders.find(function(e){return e.isRecycleBin}),c=i.isHome?null:{id:i.previous,name:"...",icon:"images/file/folder-icon.svg",style:"",isRecycleBin:!1,isSharing:!1,isPrevious:!0},u=i.files.length?r.a.createElement(r.a.Fragment,null,i.files.map(function(t,n){return r.a.createElement(g.a,{key:t.id,file:t,openViewer:e.props.openViewer})})):null,f=r.a.createElement(r.a.Fragment,null,r.a.createElement(y.a,{folder:c,isPrevious:!0,gotoFolder:this.gotoFolder.bind(this)}),i.folders.map(function(t){if(!t.isRecycleBin)return r.a.createElement(y.a,{key:t.id,folder:t,isHome:i.isHome,gotoFolder:e.gotoFolder.bind(e)})}),r.a.createElement(y.a,{folder:a,gotoFolder:this.gotoFolder.bind(this)}));return r.a.createElement("div",{className:l.a.items},r.a.createElement(m,{path:i.path,gotoFolder:this.gotoFolder.bind(this)}),r.a.createElement("div",{className:l.a.listing},f,u))}}])&&v(n.prototype,o),i&&v(n,i),t}();t.default=j}}]);